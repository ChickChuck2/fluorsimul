(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))y(n);new MutationObserver(n=>{for(const r of n)if(r.type==="childList")for(const f of r.addedNodes)f.tagName==="LINK"&&f.rel==="modulepreload"&&y(f)}).observe(document,{childList:!0,subtree:!0});function s(n){const r={};return n.integrity&&(r.integrity=n.integrity),n.referrerPolicy&&(r.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?r.credentials="include":n.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function y(n){if(n.ep)return;n.ep=!0;const r=s(n);fetch(n.href,r)}})();const A=document.getElementById("start-btn"),B=document.getElementById("speed-btn"),M=document.getElementById("reset-btn"),h=document.getElementById("status-text"),G=document.getElementById("input-ppm"),v=document.getElementById("output-ppm"),O=document.getElementById("log"),d=document.getElementById("liquid-1"),u=document.getElementById("liquid-2"),D=document.getElementById("flow-intro"),R=document.getElementById("flow-stage1-2"),P=document.getElementById("flow-outro"),l=document.getElementById("liquid-3"),_=document.getElementById("timer-text"),E=document.getElementById("result-indicator");let S=!1,i=1,o=null,m=1800,a=0;const p={STAGE_1:900*1e3,STAGE_2:720*1e3,TEST:180*1e3},c=e=>{const t=new Date().toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",second:"2-digit"});O.innerHTML=`<div>[${t}] ${e}</div>`+O.innerHTML},I=(e,t)=>{G.innerHTML=`${e.toFixed(1)} <span style="font-size: 0.8rem; font-weight: 400;">ppm</span>`,t!==null?(v.innerHTML=`${t.toFixed(2)} <span style="font-size: 0.8rem; font-weight: 400;">ppm</span>`,v.style.color=t<1.5?"var(--fluoride-low)":"var(--fluoride-high)"):(v.innerHTML='-- <span style="font-size: 0.8rem; font-weight: 400;">ppm</span>',v.style.color="inherit")},L=e=>{const t=Math.floor(e/60),s=Math.floor(e%60);_.innerText=`${t.toString().padStart(2,"0")}:${s.toString().padStart(2,"0")}`},x=e=>{o&&clearInterval(o),o=setInterval(()=>{if(a!==e){o&&clearInterval(o);return}m-=1,m<=0&&(m=0,o&&clearInterval(o)),L(m)},1e3/i)},$=(e,t)=>new Promise((s,y)=>{let n=0;const r=50,g=setInterval(()=>{if(a!==t){clearInterval(g),y("Simulação cancelada");return}n+=r*i,n>=e&&(clearInterval(g),s(!0))},r)}),T=(e,t)=>{switch(h.innerText=e,t){case"RODANDO":h.style.color="var(--accent-color)";break;case"SUCESSO":h.style.color="var(--success-color)";break;case"AGUARDANDO":h.style.color="var(--warning-color)";break;default:h.style.color="var(--text-secondary)"}},q=async()=>{if(S)return;S=!0,A.disabled=!0;const e=++a;T("FILTRANDO...","RODANDO"),m=1800,L(m),x(e);try{c("Passo 1: Cal adicionada. Tempo real: 15 min."),D?.classList.add("active");const t=()=>{d&&(d.style.transition=`height ${3e3/i}ms linear, y ${3e3/i}ms linear`),u&&(u.style.transition=`height ${3e3/i}ms linear, y ${3e3/i}ms linear`),l&&(l.style.transition=`height ${p.STAGE_2/i}ms linear, y ${p.STAGE_2/i}ms linear`)};if(t(),d&&(d.setAttribute("height","180"),d.setAttribute("y","170")),await w(50,10,p.STAGE_1,e),a!==e||(c("Flúor caiu: 50 -> 10 ppm."),c("Passo 2: Polimento com Alumina. Tempo real: 12 min."),R?.classList.add("active"),t(),u&&(u.setAttribute("height","180"),u.setAttribute("y","170")),P?.classList.add("active"),l&&(l.setAttribute("height","150"),l.setAttribute("y","200")),await w(10,.82,p.STAGE_2,e),a!==e))return;c("Água polida! Nível final: 0.82 ppm."),c("Teste de Qualidade: O Rosa indica que está pura."),await $(p.TEST/2,e),E&&(E.style.transition=`fill ${2e3/i}ms`,E.style.fill="var(--spadns-pink)"),await $(p.TEST/2,e),T("PRONTO","SUCESSO"),c("RESULTADO: Água Aprovada (Rosa = Limpa).")}catch(t){console.log("Simulação interrompida ou erro:",t)}finally{a===e&&(A.disabled=!1,S=!1)}},w=(e,t,s,y)=>new Promise(n=>{let r=0;const f=50,g=setInterval(()=>{if(a!==y){clearInterval(g);return}r+=f*i;const b=Math.min(1,r/s),N=e+(t-e)*b;I(50,N),b>=1&&(clearInterval(g),I(50,t),n(!0))},f)}),U=()=>{i===1?i=10:i===10?i=100:i===100?i=1e3:i=1,B.innerText=`ACELERAR (${i}x)`,c(`Velocidade ajustada para ${i}x`),S&&(x(a),(()=>{if(d&&(d.style.transition=`height ${3e3/i}ms linear, y ${3e3/i}ms linear`),u&&(u.style.transition=`height ${3e3/i}ms linear, y ${3e3/i}ms linear`),l){const t=150-parseFloat(l.getAttribute("height")||"0"),s=p.STAGE_2*(t/150)/i;l.style.transition=`height ${s}ms linear, y ${s}ms linear`}})())},F=()=>{a++,S=!1,A.disabled=!1,o&&clearInterval(o),m=1800,L(m),T("AGUARDANDO","AGUARDANDO"),I(50,null),c("Sistema reiniciado e pronto para novo ciclo."),[d,u,l].forEach(e=>{e&&(e.style.transition="none",e.setAttribute("height","0"),e.setAttribute("y","350"))}),[D,R,P].forEach(e=>e?.classList.remove("active")),E&&(E.style.fill="rgba(48, 54, 61, 0.5)")};A?.addEventListener("click",q);B?.addEventListener("click",U);M?.addEventListener("click",F);console.log("Simulation ready.");
