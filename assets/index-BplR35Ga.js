(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&s(a)}).observe(document,{childList:!0,subtree:!0});function i(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerPolicy&&(o.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?o.credentials="include":n.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(n){if(n.ep)return;n.ep=!0;const o=i(n);fetch(n.href,o)}})();const $=document.getElementById("start-btn"),nt=document.getElementById("speed-btn"),dt=document.getElementById("reset-btn"),A=document.getElementById("status-text"),K=document.getElementById("log"),mt=document.getElementById("timer-text"),J=document.getElementById("ph-display"),B=document.getElementById("output-ppm-main"),it=document.getElementById("flow-rate"),x=document.getElementById("interlock-status"),d=document.getElementById("liquid-1"),m=document.getElementById("liquid-2"),N=document.getElementById("flow-intro"),D=document.getElementById("flow-stage1-2"),_=document.getElementById("flow-outro"),g=document.getElementById("liquid-3"),L=document.getElementById("result-indicator"),b=document.getElementById("filter-status"),ut=document.getElementById("total-volume"),pt=document.getElementById("total-cost"),W=document.getElementById("regen-btn"),M=document.getElementById("particles-group"),u=document.getElementById("ppm-chart"),p=u.getContext("2d"),T=document.getElementById("sludge-1"),C=document.getElementById("cascade-1"),F=document.getElementById("cascade-2"),G=document.getElementById("cascade-3"),U=document.getElementById("ripple-1"),k=document.getElementById("ripple-2"),H=document.getElementById("ripple-3"),Q=document.getElementById("stop-top"),X=document.getElementById("stop-bottom");let w=!1,r=1,y=null,h=1815,f=0,v=0,ot=0,st=0,O=[];const c={PIPE_FLOW:2*1e3,INTRO:5*1e3,STAGE_1:900*1e3,TRANS_1_2:5*1e3,STAGE_2:720*1e3,TRANS_2_3:5*1e3,TEST:180*1e3},P=Object.values(c).reduce((t,e)=>t+e,0)/1e3,l=t=>{const e=new Date().toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",second:"2-digit"});K.innerHTML=`<div>[${e}] ${t}</div>`+K.innerHTML},q=t=>{t!==null?(B.innerText=`${t.toFixed(2)} ppm`,B.style.color=t<1.5?"var(--fluoride-low)":"var(--fluoride-high)",V(t)):(B.innerText="-- ppm",B.style.color="inherit")},V=t=>{if(!Q||!X)return;const e=Math.max(0,Math.min(1,t/50)),i=210-e*180,s=100-e*60,n=67-e*37,o=`hsl(${i}, ${s}%, ${n}%)`,a=`hsl(${i}, ${s}%, ${n-15}%)`;Q.setAttribute("style",`stop-color: ${o}; stop-opacity: 1`),X.setAttribute("style",`stop-color: ${a}; stop-opacity: 1`)},rt=t=>{const e=(Math.random()-.5)*.04,i=t+e;J.innerText=i.toFixed(2),J.style.color=t>=5.5&&t<=6.5?"var(--fluoride-low)":t>10?"var(--warning-color)":"var(--accent-color)"},j=t=>{const e=Math.floor(t/60),i=Math.floor(t%60);mt.innerText=`${e.toString().padStart(2,"0")}:${i.toString().padStart(2,"0")}`},Y=()=>{ut.innerText=`${ot} L`,pt.innerText=`R$ ${st.toFixed(2)}`},ft=()=>{if(!p||O.length===0)return;p.clearRect(0,0,u.width,u.height),p.strokeStyle="#58a6ff",p.lineWidth=2,p.beginPath();const t=u.width,e=u.height,i=50;O.forEach((s,n)=>{const o=s.x/P*t,a=e-s.y/i*e;n===0?p.moveTo(o,a):p.lineTo(o,a)}),p.stroke()},Z=t=>{if(M){if(!t){M.innerHTML="";return}for(let e=0;e<30;e++){const i=document.createElementNS("http://www.w3.org/2000/svg","circle");i.setAttribute("class","precipitate-particle"),i.setAttribute("r",(Math.random()*2+1).toString()),i.setAttribute("cx",(160+Math.random()*180).toString()),i.setAttribute("cy",(150+Math.random()*50).toString()),i.style.animation=`precipitate ${2+Math.random()*2}s linear infinite`,i.style.animationDelay=`${Math.random()*2}s`,M.appendChild(i)}}},at=t=>{y&&clearInterval(y),y=setInterval(()=>{if(f!==t){y&&clearInterval(y);return}h-=1,h<=0&&(h=0,y&&clearInterval(y)),j(h)},1e3/r)},S=(t,e)=>new Promise((i,s)=>{let n=0;const o=50,E=setInterval(()=>{if(f!==e){clearInterval(E),s("Simulação cancelada");return}n+=o*r,n>=t&&(clearInterval(E),i(!0))},o)}),lt=(t,e)=>{switch(A.innerText=t,e){case"RODANDO":A.style.color="var(--accent-color)";break;case"SUCESSO":A.style.color="var(--success-color)";break;case"AGUARDANDO":A.style.color="var(--warning-color)";break;default:A.style.color="var(--text-secondary)"}},yt=async()=>{if(w)return;w=!0,$.disabled=!0;const t=++f;l("Iniciando Planta Técnica Industrial..."),it.innerText="5.0 m³/h",h=P,j(h),at(t);try{const e=s=>{const n=s!==void 0?s:5e3/r;d&&(d.style.transition=`height ${n}ms linear, y ${n}ms linear`),m&&(m.style.transition=`height ${n}ms linear, y ${n}ms linear`),g&&(g.style.transition=`height ${n}ms linear, y ${n}ms linear`)};if(l("ETAPA 1: Água bruta correndo pela tubulação..."),N?.classList.add("active"),await S(c.PIPE_FLOW,t),l("Dosando Cal Hidratada. Setpoint pH 10.5."),C?.classList.add("active"),U?.classList.add("active"),Z(!0),e(),d&&(d.setAttribute("height","180"),d.setAttribute("y","170")),await et(7,10.5,c.INTRO,t),C?.classList.remove("active"),U?.classList.remove("active"),N?.classList.remove("active"),T&&(T.style.transition=`height ${c.STAGE_1/r}ms linear, y ${c.STAGE_1/r}ms linear`,T.setAttribute("height","30"),T.setAttribute("y","320")),await tt(50,10,c.STAGE_1,t),f!==t)return;Z(!1),l("Precipitação concluída: Lodo sedimentado no fundo."),l("Transferindo e dosando Ácido..."),D?.classList.add("active"),e(),d&&(d.setAttribute("height","0"),d.setAttribute("y","350")),await S(c.PIPE_FLOW,t),F?.classList.add("active"),k?.classList.add("active"),m&&(m.setAttribute("height","180"),m.setAttribute("y","170")),await et(10.5,5.8,c.TRANS_1_2,t),x.style.borderColor="var(--success-color)",x.querySelector(".stat-value").textContent="SISTEMA SEGURO",F?.classList.remove("active"),k?.classList.remove("active"),D?.classList.remove("active"),l("Monitoramento Etapa 5: Condição ótima (pH 5.8) atingida."),l("ETAPA 2: Adsorção por Alumina Ativada. EBCT: 6 min.");const i=v>=3?4.5:.82;if(v>=3&&l("AVISO: Filtro saturado! Eficiência reduzida."),await tt(10,i,c.STAGE_2,t),f!==t)return;if(l("Tratamento concluído. Direcionando para reservatório."),_?.classList.add("active"),e(),m&&(m.setAttribute("height","0"),m.setAttribute("y","350")),await S(c.PIPE_FLOW,t),G?.classList.add("active"),H?.classList.add("active"),g&&(g.setAttribute("height","150"),g.setAttribute("y","200")),await S(c.TRANS_2_3,t),G?.classList.remove("active"),H?.classList.remove("active"),_?.classList.remove("active"),l("Monitoramento Final: Água tratada com sucesso."),L&&(L.style.transition=`fill ${c.TEST/r}ms`,L.style.fill="var(--spadns-pink)"),await S(c.TEST,t),l(`RESULTADO FINAL: ${i} ppm (Remoção Eficiente).`),Y(),v++,lt("PRONTO","SUCESSO"),l("RESULTADO: Água Aprovada (Rosa = Limpa)."),ot+=20,st+=.05,Y(),v>=3)b.innerText="SATURADO (NECESSITA REGEN.)",b.style.color="var(--danger-color)",W.style.display="block";else{const s=100-v*10;b.innerText=`EFICIENTE (${s}%)`}}catch(e){console.log("Simulação interrompida ou erro:",e)}finally{f===t&&($.disabled=!1,w=!1)}},tt=(t,e,i,s)=>new Promise(n=>{let o=0;const a=50,E=setInterval(()=>{if(f!==s){clearInterval(E);return}o+=a*r;const I=Math.min(1,o/i),R=Math.pow(I,.7),z=t+(e-t)*R;q(z);const ct=P-h;O.push({x:ct,y:z}),ft(),I>=1&&(clearInterval(E),q(e),n(!0))},a)}),et=(t,e,i,s)=>new Promise(n=>{let o=0;const a=50,E=setInterval(()=>{if(f!==s){clearInterval(E);return}o+=a*r;const I=Math.min(1,o/i),R=t+(e-t)*I;rt(R),I>=1&&(clearInterval(E),n(!0))},a)}),gt=()=>{r===1?r=10:r===10?r=100:r===100?r=1e3:r=1,nt.innerText=`ACELERAR (${r}x)`,l(`Velocidade ajustada para ${r}x`),w&&(at(f),(()=>{const e=5e3/r;if(d&&(d.style.transition=`height ${e}ms linear, y ${e}ms linear`),m&&(m.style.transition=`height ${e}ms linear, y ${e}ms linear`),g){const s=5e3*((150-parseFloat(g.getAttribute("height")||"0"))/150)/r;g.style.transition=`height ${s}ms linear, y ${s}ms linear`}})())},ht=()=>{f++,w=!1,$.disabled=!1,O=[],p&&p.clearRect(0,0,u.width,u.height),rt(7),q(null),V(50),it.innerText="0.0 m³/h",y&&clearInterval(y),h=P,j(h),lt("AGUARDANDO","AGUARDANDO"),l("Sistema reiniciado e pronto para novo ciclo."),x.style.borderColor="var(--glass-border)",x.querySelector(".stat-value").textContent="SISTEMA SEGURO",[d,m,g,T].forEach(t=>{t&&(t.style.transition="none",t.setAttribute("height","0"),t.setAttribute("y","350"))}),[N,D,_,C,F,G,U,k,H].forEach(t=>t?.classList.remove("active")),L&&(L.style.fill="rgba(48, 54, 61, 0.5)")},Et=()=>{v=0,b.innerText="EFICIENTE (100%)",b.style.color="var(--accent-color)",W.style.display="none",l("Filtro regenerado com NaOH com sucesso!")};$?.addEventListener("click",yt);nt?.addEventListener("click",gt);dt?.addEventListener("click",ht);W?.addEventListener("click",Et);u.width=u.offsetWidth;u.height=u.offsetHeight;V(50);console.log("Simulation ready.");
