(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const r of n)if(r.type==="childList")for(const u of r.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&s(u)}).observe(document,{childList:!0,subtree:!0});function i(n){const r={};return n.integrity&&(r.integrity=n.integrity),n.referrerPolicy&&(r.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?r.credentials="include":n.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(n){if(n.ep)return;n.ep=!0;const r=i(n);fetch(n.href,r)}})();const L=document.getElementById("start-btn"),q=document.getElementById("speed-btn"),j=document.getElementById("reset-btn"),S=document.getElementById("status-text"),K=document.getElementById("input-ppm"),b=document.getElementById("output-ppm"),H=document.getElementById("log"),l=document.getElementById("liquid-1"),c=document.getElementById("liquid-2"),x=document.getElementById("flow-intro"),B=document.getElementById("flow-stage1-2"),N=document.getElementById("flow-outro"),p=document.getElementById("liquid-3"),Q=document.getElementById("timer-text"),T=document.getElementById("result-indicator"),A=document.getElementById("filter-status"),J=document.getElementById("total-volume"),X=document.getElementById("total-cost"),M=document.getElementById("regen-btn"),R=document.getElementById("particles-group"),d=document.getElementById("ppm-chart"),m=d.getContext("2d");let I=!1,o=1,f=null,g=1815,y=0,E=0,k=0,V=0,O=[];const h={INTRO:5*1e3,STAGE_1:900*1e3,TRANS_1_2:5*1e3,STAGE_2:720*1e3,TRANS_2_3:5*1e3,TEST:180*1e3},$=Object.values(h).reduce((e,t)=>e+t,0)/1e3,a=e=>{const t=new Date().toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",second:"2-digit"});H.innerHTML=`<div>[${t}] ${e}</div>`+H.innerHTML},D=(e,t)=>{K.innerHTML=`${e.toFixed(1)} <span style="font-size: 0.8rem; font-weight: 400;">ppm</span>`,t!==null?(b.innerHTML=`${t.toFixed(2)} <span style="font-size: 0.8rem; font-weight: 400;">ppm</span>`,b.style.color=t<1.5?"var(--fluoride-low)":"var(--fluoride-high)"):(b.innerHTML='-- <span style="font-size: 0.8rem; font-weight: 400;">ppm</span>',b.style.color="inherit")},_=e=>{const t=Math.floor(e/60),i=Math.floor(e%60);Q.innerText=`${t.toString().padStart(2,"0")}:${i.toString().padStart(2,"0")}`},Y=()=>{J.innerText=`${k} L`,X.innerText=`R$ ${V.toFixed(2)}`},Z=()=>{if(!m||O.length===0)return;m.clearRect(0,0,d.width,d.height),m.strokeStyle="#58a6ff",m.lineWidth=2,m.beginPath();const e=d.width,t=d.height,i=50;O.forEach((s,n)=>{const r=s.x/$*e,u=t-s.y/i*t;n===0?m.moveTo(r,u):m.lineTo(r,u)}),m.stroke()},G=e=>{if(R){if(!e){R.innerHTML="";return}for(let t=0;t<30;t++){const i=document.createElementNS("http://www.w3.org/2000/svg","circle");i.setAttribute("class","precipitate-particle"),i.setAttribute("r",(Math.random()*2+1).toString()),i.setAttribute("cx",(160+Math.random()*180).toString()),i.setAttribute("cy",(150+Math.random()*50).toString()),i.style.animation=`precipitate ${2+Math.random()*2}s linear infinite`,i.style.animationDelay=`${Math.random()*2}s`,R.appendChild(i)}}},z=e=>{f&&clearInterval(f),f=setInterval(()=>{if(y!==e){f&&clearInterval(f);return}g-=1,g<=0&&(g=0,f&&clearInterval(f)),_(g)},1e3/o)},w=(e,t)=>new Promise((i,s)=>{let n=0;const r=50,v=setInterval(()=>{if(y!==t){clearInterval(v),s("Simulação cancelada");return}n+=r*o,n>=e&&(clearInterval(v),i(!0))},r)}),P=(e,t)=>{switch(S.innerText=e,t){case"RODANDO":S.style.color="var(--accent-color)";break;case"SUCESSO":S.style.color="var(--success-color)";break;case"AGUARDANDO":S.style.color="var(--warning-color)";break;default:S.style.color="var(--text-secondary)"}},ee=async()=>{if(I)return;I=!0,L.disabled=!0;const e=++y;P("FILTRANDO...","RODANDO"),g=$,_(g),z(e);try{const t=s=>{const n=s!==void 0?s:5e3/o;l&&(l.style.transition=`height ${n}ms linear, y ${n}ms linear`),c&&(c.style.transition=`height ${n}ms linear, y ${n}ms linear`),p&&(p.style.transition=`height ${n}ms linear, y ${n}ms linear`)};if(a("Passo 1: Cal adicionada. Tempo real: 15 min."),x?.classList.add("active"),G(!0),t(),l&&(l.setAttribute("height","180"),l.setAttribute("y","170")),await w(h.INTRO,e),x?.classList.remove("active"),await U(50,10,h.STAGE_1,e),y!==e)return;G(!1),a("Flúor caiu: 50 -> 10 ppm."),a("Transferindo água para Alumina..."),B?.classList.add("active"),t(),l&&(l.setAttribute("height","0"),l.setAttribute("y","350")),c&&(c.setAttribute("height","180"),c.setAttribute("y","170")),await w(h.TRANS_1_2,e),B?.classList.remove("active"),a("Passo 2: Polimento com Alumina. Tempo real: 12 min.");const i=E>=3?4.5:.82;if(E>=3&&a("AVISO: Filtro saturado! Eficiência reduzida."),await U(10,i,h.STAGE_2,e),y!==e)return;if(a(`Água polida! Nível final: ${i} ppm.`),a("Enchendo reservatório de saída..."),N?.classList.add("active"),t(),c&&(c.setAttribute("height","0"),c.setAttribute("y","350")),p&&(p.setAttribute("height","150"),p.setAttribute("y","200")),await w(h.TRANS_2_3,e),N?.classList.remove("active"),a("Teste de Qualidade: O Rosa indica que está pura."),T&&(T.style.transition=`fill ${h.TEST/o}ms`,T.style.fill="var(--spadns-pink)"),await w(h.TEST,e),P("PRONTO","SUCESSO"),a("RESULTADO: Água Aprovada (Rosa = Limpa)."),E++,k+=20,V+=.05,Y(),E>=3)A.innerText="SATURADO (NECESSITA REGEN.)",A.style.color="var(--danger-color)",M.style.display="block";else{const s=100-E*10;A.innerText=`EFICIENTE (${s}%)`}}catch(t){console.log("Simulação interrompida ou erro:",t)}finally{y===e&&(L.disabled=!1,I=!1)}},U=(e,t,i,s)=>new Promise(n=>{let r=0;const u=50,v=setInterval(()=>{if(y!==s){clearInterval(v);return}r+=u*o;const C=Math.min(1,r/i),F=e+(t-e)*C;D(50,F);const W=$-g;O.push({x:W,y:F}),Z(),C>=1&&(clearInterval(v),D(50,t),n(!0))},u)}),te=()=>{o===1?o=10:o===10?o=100:o===100?o=1e3:o=1,q.innerText=`ACELERAR (${o}x)`,a(`Velocidade ajustada para ${o}x`),I&&(z(y),(()=>{const t=5e3/o;if(l&&(l.style.transition=`height ${t}ms linear, y ${t}ms linear`),c&&(c.style.transition=`height ${t}ms linear, y ${t}ms linear`),p){const s=5e3*((150-parseFloat(p.getAttribute("height")||"0"))/150)/o;p.style.transition=`height ${s}ms linear, y ${s}ms linear`}})())},ne=()=>{y++,I=!1,L.disabled=!1,O=[],m&&m.clearRect(0,0,d.width,d.height),f&&clearInterval(f),g=$,_(g),P("AGUARDANDO","AGUARDANDO"),D(50,null),a("Sistema reiniciado e pronto para novo ciclo."),[l,c,p].forEach(e=>{e&&(e.style.transition="none",e.setAttribute("height","0"),e.setAttribute("y","350"))}),[x,B,N].forEach(e=>e?.classList.remove("active")),T&&(T.style.fill="rgba(48, 54, 61, 0.5)")},ie=()=>{E=0,A.innerText="EFICIENTE (100%)",A.style.color="var(--accent-color)",M.style.display="none",a("Filtro regenerado com NaOH com sucesso!")};L?.addEventListener("click",ee);q?.addEventListener("click",te);j?.addEventListener("click",ne);M?.addEventListener("click",ie);d.width=d.offsetWidth;d.height=d.offsetHeight;console.log("Simulation ready.");
