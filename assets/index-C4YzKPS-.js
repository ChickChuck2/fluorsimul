(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))o(n);new MutationObserver(n=>{for(const r of n)if(r.type==="childList")for(const l of r.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&o(l)}).observe(document,{childList:!0,subtree:!0});function i(n){const r={};return n.integrity&&(r.integrity=n.integrity),n.referrerPolicy&&(r.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?r.credentials="include":n.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function o(n){if(n.ep)return;n.ep=!0;const r=i(n);fetch(n.href,r)}})();const B=document.getElementById("start-btn"),j=document.getElementById("speed-btn"),Z=document.getElementById("reset-btn"),S=document.getElementById("status-text"),U=document.getElementById("log"),tt=document.getElementById("timer-text"),G=document.getElementById("ph-display"),x=document.getElementById("output-ppm-main"),W=document.getElementById("flow-rate"),et=document.getElementById("turbidity-val"),O=document.getElementById("interlock-status"),c=document.getElementById("liquid-1"),d=document.getElementById("liquid-2"),P=document.getElementById("flow-intro"),D=document.getElementById("flow-stage1-2"),M=document.getElementById("flow-outro"),p=document.getElementById("liquid-3"),T=document.getElementById("result-indicator"),I=document.getElementById("filter-status"),nt=document.getElementById("total-volume"),it=document.getElementById("total-cost"),_=document.getElementById("regen-btn"),$=document.getElementById("particles-group"),u=document.getElementById("ppm-chart"),m=u.getContext("2d");let b=!1,s=1,g=null,y=1815,f=0,v=0,z=0,K=0,R=[];const E={INTRO:5*1e3,STAGE_1:900*1e3,TRANS_1_2:5*1e3,STAGE_2:720*1e3,TRANS_2_3:5*1e3,TEST:180*1e3},L=Object.values(E).reduce((t,e)=>t+e,0)/1e3,a=t=>{const e=new Date().toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",second:"2-digit"});U.innerHTML=`<div>[${e}] ${t}</div>`+U.innerHTML},C=t=>{t!==null?(x.innerText=`${t.toFixed(2)} ppm`,x.style.color=t<1.5?"var(--fluoride-low)":"var(--fluoride-high)"):(x.innerText="-- ppm",x.style.color="inherit")},J=t=>{G.innerText=t.toFixed(2),G.style.color=t>=5.5&&t<=6.5?"var(--fluoride-low)":t>10?"var(--warning-color)":"var(--accent-color)"},F=t=>{const e=Math.floor(t/60),i=Math.floor(t%60);tt.innerText=`${e.toString().padStart(2,"0")}:${i.toString().padStart(2,"0")}`},H=()=>{nt.innerText=`${z} L`,it.innerText=`R$ ${K.toFixed(2)}`},rt=()=>{if(!m||R.length===0)return;m.clearRect(0,0,u.width,u.height),m.strokeStyle="#58a6ff",m.lineWidth=2,m.beginPath();const t=u.width,e=u.height,i=50;R.forEach((o,n)=>{const r=o.x/L*t,l=e-o.y/i*e;n===0?m.moveTo(r,l):m.lineTo(r,l)}),m.stroke()},k=t=>{if($){if(!t){$.innerHTML="";return}for(let e=0;e<30;e++){const i=document.createElementNS("http://www.w3.org/2000/svg","circle");i.setAttribute("class","precipitate-particle"),i.setAttribute("r",(Math.random()*2+1).toString()),i.setAttribute("cx",(160+Math.random()*180).toString()),i.setAttribute("cy",(150+Math.random()*50).toString()),i.style.animation=`precipitate ${2+Math.random()*2}s linear infinite`,i.style.animationDelay=`${Math.random()*2}s`,$.appendChild(i)}}},Q=t=>{g&&clearInterval(g),g=setInterval(()=>{if(f!==t){g&&clearInterval(g);return}y-=1,y<=0&&(y=0,g&&clearInterval(g)),F(y)},1e3/s)},N=(t,e)=>new Promise((i,o)=>{let n=0;const r=50,h=setInterval(()=>{if(f!==e){clearInterval(h),o("Simulação cancelada");return}n+=r*s,n>=t&&(clearInterval(h),i(!0))},r)}),X=(t,e)=>{switch(S.innerText=t,e){case"RODANDO":S.style.color="var(--accent-color)";break;case"SUCESSO":S.style.color="var(--success-color)";break;case"AGUARDANDO":S.style.color="var(--warning-color)";break;default:S.style.color="var(--text-secondary)"}},ot=async()=>{if(b)return;b=!0,B.disabled=!0;const t=++f;a("Iniciando Planta Técnica Industrial..."),W.innerText="5.0 m³/h",y=L,F(y),Q(t);try{const e=o=>{const n=o!==void 0?o:5e3/s;c&&(c.style.transition=`height ${n}ms linear, y ${n}ms linear`),d&&(d.style.transition=`height ${n}ms linear, y ${n}ms linear`),p&&(p.style.transition=`height ${n}ms linear, y ${n}ms linear`)};if(a("ETAPA 1: Dosagem de Cal Hidratada. Setpoint pH 10.5."),P?.classList.add("active"),k(!0),e(),c&&(c.setAttribute("height","180"),c.setAttribute("y","170")),await V(7,10.5,E.INTRO,t),await N(1e3,t),P?.classList.remove("active"),await q(50,10,E.STAGE_1,t),f!==t)return;k(!1),a("Precipitação concluída: Flúor caiu para 10 ppm."),et.innerText="0.08 NTU",a("ETAPA CRÍTICA: Ajustando pH para 5.8 via Dosador de Ácido."),D?.classList.add("active"),e(),c&&(c.setAttribute("height","0"),c.setAttribute("y","350")),d&&(d.setAttribute("height","180"),d.setAttribute("y","170")),await V(10.5,5.8,E.TRANS_1_2,t),O.style.borderColor="var(--success-color)",O.querySelector(".stat-value").textContent="SISTEMA SEGURO",D?.classList.remove("active"),a("Monitoramento Etapa 5: pH estabilizado em 5.8. Alumina segura."),a("ETAPA 2: Adsorção por Alumina Ativada. EBCT: 6 min.");const i=v>=3?4.5:.82;if(v>=3&&a("AVISO: Filtro saturado! Eficiência reduzida."),await q(10,i,E.STAGE_2,t),f!==t)return;if(a("Transferindo água tratada para reservatório final."),M?.classList.add("active"),e(),d&&(d.setAttribute("height","0"),d.setAttribute("y","350")),p&&(p.setAttribute("height","150"),p.setAttribute("y","200")),await N(E.TRANS_2_3,t),M?.classList.remove("active"),a("Monitoramento Final: Água tratada com sucesso."),T&&(T.style.transition=`fill ${E.TEST/s}ms`,T.style.fill="var(--spadns-pink)"),await N(E.TEST,t),a(`RESULTADO FINAL: ${i} ppm (Remoção Eficiente).`),H(),v++,X("PRONTO","SUCESSO"),a("RESULTADO: Água Aprovada (Rosa = Limpa)."),z+=20,K+=.05,H(),v>=3)I.innerText="SATURADO (NECESSITA REGEN.)",I.style.color="var(--danger-color)",_.style.display="block";else{const o=100-v*10;I.innerText=`EFICIENTE (${o}%)`}}catch(e){console.log("Simulação interrompida ou erro:",e)}finally{f===t&&(B.disabled=!1,b=!1)}},q=(t,e,i,o)=>new Promise(n=>{let r=0;const l=50,h=setInterval(()=>{if(f!==o){clearInterval(h);return}r+=l*s;const A=Math.min(1,r/i),w=t+(e-t)*A;C(w);const Y=L-y;R.push({x:Y,y:w}),rt(),A>=1&&(clearInterval(h),C(e),n(!0))},l)}),V=(t,e,i,o)=>new Promise(n=>{let r=0;const l=50,h=setInterval(()=>{if(f!==o){clearInterval(h);return}r+=l*s;const A=Math.min(1,r/i),w=t+(e-t)*A;J(w),A>=1&&(clearInterval(h),n(!0))},l)}),st=()=>{s===1?s=10:s===10?s=100:s===100?s=1e3:s=1,j.innerText=`ACELERAR (${s}x)`,a(`Velocidade ajustada para ${s}x`),b&&(Q(f),(()=>{const e=5e3/s;if(c&&(c.style.transition=`height ${e}ms linear, y ${e}ms linear`),d&&(d.style.transition=`height ${e}ms linear, y ${e}ms linear`),p){const o=5e3*((150-parseFloat(p.getAttribute("height")||"0"))/150)/s;p.style.transition=`height ${o}ms linear, y ${o}ms linear`}})())},at=()=>{f++,b=!1,B.disabled=!1,R=[],m&&m.clearRect(0,0,u.width,u.height),J(7),C(null),W.innerText="0.0 m³/h",g&&clearInterval(g),y=L,F(y),X("AGUARDANDO","AGUARDANDO"),a("Sistema reiniciado e pronto para novo ciclo."),O.style.borderColor="var(--glass-border)",O.querySelector(".stat-value").textContent="SISTEMA SEGURO",[c,d,p].forEach(t=>{t&&(t.style.transition="none",t.setAttribute("height","0"),t.setAttribute("y","350"))}),[P,D,M].forEach(t=>t?.classList.remove("active")),T&&(T.style.fill="rgba(48, 54, 61, 0.5)")},lt=()=>{v=0,I.innerText="EFICIENTE (100%)",I.style.color="var(--accent-color)",_.style.display="none",a("Filtro regenerado com NaOH com sucesso!")};B?.addEventListener("click",ot);j?.addEventListener("click",st);Z?.addEventListener("click",at);_?.addEventListener("click",lt);u.width=u.offsetWidth;u.height=u.offsetHeight;console.log("Simulation ready.");
