(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))p(n);new MutationObserver(n=>{for(const r of n)if(r.type==="childList")for(const f of r.addedNodes)f.tagName==="LINK"&&f.rel==="modulepreload"&&p(f)}).observe(document,{childList:!0,subtree:!0});function s(n){const r={};return n.integrity&&(r.integrity=n.integrity),n.referrerPolicy&&(r.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?r.credentials="include":n.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function p(n){if(n.ep)return;n.ep=!0;const r=s(n);fetch(n.href,r)}})();const I=document.getElementById("start-btn"),P=document.getElementById("speed-btn"),M=document.getElementById("reset-btn"),y=document.getElementById("status-text"),q=document.getElementById("input-ppm"),S=document.getElementById("output-ppm"),D=document.getElementById("log"),a=document.getElementById("liquid-1"),o=document.getElementById("liquid-2"),T=document.getElementById("flow-intro"),b=document.getElementById("flow-stage1-2"),L=document.getElementById("flow-outro"),d=document.getElementById("liquid-3"),G=document.getElementById("timer-text"),A=document.getElementById("result-indicator");let E=!1,i=1,c=null,m=1800,u=0;const v={STAGE_1:900*1e3,STAGE_2:720*1e3,TEST:180*1e3},l=e=>{const t=new Date().toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",second:"2-digit"});D.innerHTML=`<div>[${t}] ${e}</div>`+D.innerHTML},w=(e,t)=>{q.innerHTML=`${e.toFixed(1)} <span style="font-size: 0.8rem; font-weight: 400;">ppm</span>`,t!==null?(S.innerHTML=`${t.toFixed(2)} <span style="font-size: 0.8rem; font-weight: 400;">ppm</span>`,S.style.color=t<1.5?"var(--fluoride-low)":"var(--fluoride-high)"):(S.innerHTML='-- <span style="font-size: 0.8rem; font-weight: 400;">ppm</span>',S.style.color="inherit")},$=e=>{const t=Math.floor(e/60),s=Math.floor(e%60);G.innerText=`${t.toString().padStart(2,"0")}:${s.toString().padStart(2,"0")}`},x=e=>{c&&clearInterval(c),c=setInterval(()=>{if(u!==e){c&&clearInterval(c);return}m-=1,m<=0&&(m=0,c&&clearInterval(c)),$(m)},1e3/i)},h=(e,t)=>new Promise((s,p)=>{let n=0;const r=50,g=setInterval(()=>{if(u!==t){clearInterval(g),p("Simulação cancelada");return}n+=r*i,n>=e&&(clearInterval(g),s(!0))},r)}),O=(e,t)=>{switch(y.innerText=e,t){case"RODANDO":y.style.color="var(--accent-color)";break;case"SUCESSO":y.style.color="var(--success-color)";break;case"AGUARDANDO":y.style.color="var(--warning-color)";break;default:y.style.color="var(--text-secondary)"}},U=async()=>{if(E)return;E=!0,I.disabled=!0;const e=++u;O("FILTRANDO...","RODANDO"),m=1800,$(m),x(e);try{l("Passo 1: Cal adicionada. Tempo real: 15 min."),T?.classList.add("active");const t=()=>{const s=3e3/i;a&&(a.style.transition=`height ${s}ms linear, y ${s}ms linear`),o&&(o.style.transition=`height ${s}ms linear, y ${s}ms linear`),d&&(d.style.transition=`height ${s}ms linear, y ${s}ms linear`)};if(t(),a&&(a.setAttribute("height","180"),a.setAttribute("y","170")),await h(3e3/i,e),T?.classList.remove("active"),await R(50,10,v.STAGE_1,e),u!==e||(l("Flúor caiu: 50 -> 10 ppm."),l("Transferindo água para Alumina..."),b?.classList.add("active"),t(),a&&(a.setAttribute("height","0"),a.setAttribute("y","350")),o&&(o.setAttribute("height","180"),o.setAttribute("y","170")),await h(3e3/i,e),b?.classList.remove("active"),l("Passo 2: Polimento com Alumina. Tempo real: 12 min."),await R(10,.82,v.STAGE_2,e),u!==e))return;l("Água polida! Nível final: 0.82 ppm."),l("Enchendo reservatório de saída..."),L?.classList.add("active"),t(),o&&(o.setAttribute("height","0"),o.setAttribute("y","350")),d&&(d.setAttribute("height","150"),d.setAttribute("y","200")),await h(3e3/i,e),L?.classList.remove("active"),l("Teste de Qualidade: O Rosa indica que está pura."),await h(v.TEST/2,e),A&&(A.style.transition=`fill ${2e3/i}ms`,A.style.fill="var(--spadns-pink)"),await h(v.TEST/2,e),O("PRONTO","SUCESSO"),l("RESULTADO: Água Aprovada (Rosa = Limpa).")}catch(t){console.log("Simulação interrompida ou erro:",t)}finally{u===e&&(I.disabled=!1,E=!1)}},R=(e,t,s,p)=>new Promise(n=>{let r=0;const f=50,g=setInterval(()=>{if(u!==p){clearInterval(g);return}r+=f*i;const B=Math.min(1,r/s),N=e+(t-e)*B;w(50,N),B>=1&&(clearInterval(g),w(50,t),n(!0))},f)}),_=()=>{i===1?i=10:i===10?i=100:i===100?i=1e3:i=1,P.innerText=`ACELERAR (${i}x)`,l(`Velocidade ajustada para ${i}x`),E&&(x(u),(()=>{if(a&&(a.style.transition=`height ${3e3/i}ms linear, y ${3e3/i}ms linear`),o&&(o.style.transition=`height ${3e3/i}ms linear, y ${3e3/i}ms linear`),d){const t=150-parseFloat(d.getAttribute("height")||"0"),s=v.STAGE_2*(t/150)/i;d.style.transition=`height ${s}ms linear, y ${s}ms linear`}})())},F=()=>{u++,E=!1,I.disabled=!1,c&&clearInterval(c),m=1800,$(m),O("AGUARDANDO","AGUARDANDO"),w(50,null),l("Sistema reiniciado e pronto para novo ciclo."),[a,o,d].forEach(e=>{e&&(e.style.transition="none",e.setAttribute("height","0"),e.setAttribute("y","350"))}),[T,b,L].forEach(e=>e?.classList.remove("active")),A&&(A.style.fill="rgba(48, 54, 61, 0.5)")};I?.addEventListener("click",U);P?.addEventListener("click",_);M?.addEventListener("click",F);console.log("Simulation ready.");
