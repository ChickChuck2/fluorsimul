(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const s of n)if(s.type==="childList")for(const l of s.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&r(l)}).observe(document,{childList:!0,subtree:!0});function i(n){const s={};return n.integrity&&(s.integrity=n.integrity),n.referrerPolicy&&(s.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?s.credentials="include":n.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(n){if(n.ep)return;n.ep=!0;const s=i(n);fetch(n.href,s)}})();const O=document.getElementById("start-btn"),Z=document.getElementById("speed-btn"),at=document.getElementById("reset-btn"),S=document.getElementById("status-text"),z=document.getElementById("log"),lt=document.getElementById("timer-text"),K=document.getElementById("ph-display"),B=document.getElementById("output-ppm-main"),tt=document.getElementById("flow-rate"),P=document.getElementById("interlock-status"),d=document.getElementById("liquid-1"),u=document.getElementById("liquid-2"),N=document.getElementById("flow-intro"),D=document.getElementById("flow-stage1-2"),_=document.getElementById("flow-outro"),y=document.getElementById("liquid-3"),L=document.getElementById("result-indicator"),b=document.getElementById("filter-status"),ct=document.getElementById("total-volume"),dt=document.getElementById("total-cost"),W=document.getElementById("regen-btn"),M=document.getElementById("particles-group"),m=document.getElementById("ppm-chart"),f=m.getContext("2d"),T=document.getElementById("sludge-1"),C=document.getElementById("cascade-1"),F=document.getElementById("cascade-2"),G=document.getElementById("cascade-3"),U=document.getElementById("ripple-1"),H=document.getElementById("ripple-2"),k=document.getElementById("ripple-3");let w=!1,o=1,p=null,h=1815,g=0,v=0,et=0,nt=0,x=[];const c={PIPE_FLOW:2*1e3,INTRO:5*1e3,STAGE_1:900*1e3,TRANS_1_2:5*1e3,STAGE_2:720*1e3,TRANS_2_3:5*1e3,TEST:180*1e3},$=Object.values(c).reduce((t,e)=>t+e,0)/1e3,a=t=>{const e=new Date().toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",second:"2-digit"});z.innerHTML=`<div>[${e}] ${t}</div>`+z.innerHTML},q=t=>{t!==null?(B.innerText=`${t.toFixed(2)} ppm`,B.style.color=t<1.5?"var(--fluoride-low)":"var(--fluoride-high)"):(B.innerText="-- ppm",B.style.color="inherit")},it=t=>{const e=(Math.random()-.5)*.04,i=t+e;K.innerText=i.toFixed(2),K.style.color=t>=5.5&&t<=6.5?"var(--fluoride-low)":t>10?"var(--warning-color)":"var(--accent-color)"},V=t=>{const e=Math.floor(t/60),i=Math.floor(t%60);lt.innerText=`${e.toString().padStart(2,"0")}:${i.toString().padStart(2,"0")}`},J=()=>{ct.innerText=`${et} L`,dt.innerText=`R$ ${nt.toFixed(2)}`},ut=()=>{if(!f||x.length===0)return;f.clearRect(0,0,m.width,m.height),f.strokeStyle="#58a6ff",f.lineWidth=2,f.beginPath();const t=m.width,e=m.height,i=50;x.forEach((r,n)=>{const s=r.x/$*t,l=e-r.y/i*e;n===0?f.moveTo(s,l):f.lineTo(s,l)}),f.stroke()},Q=t=>{if(M){if(!t){M.innerHTML="";return}for(let e=0;e<30;e++){const i=document.createElementNS("http://www.w3.org/2000/svg","circle");i.setAttribute("class","precipitate-particle"),i.setAttribute("r",(Math.random()*2+1).toString()),i.setAttribute("cx",(160+Math.random()*180).toString()),i.setAttribute("cy",(150+Math.random()*50).toString()),i.style.animation=`precipitate ${2+Math.random()*2}s linear infinite`,i.style.animationDelay=`${Math.random()*2}s`,M.appendChild(i)}}},st=t=>{p&&clearInterval(p),p=setInterval(()=>{if(g!==t){p&&clearInterval(p);return}h-=1,h<=0&&(h=0,p&&clearInterval(p)),V(h)},1e3/o)},A=(t,e)=>new Promise((i,r)=>{let n=0;const s=50,E=setInterval(()=>{if(g!==e){clearInterval(E),r("Simulação cancelada");return}n+=s*o,n>=t&&(clearInterval(E),i(!0))},s)}),rt=(t,e)=>{switch(S.innerText=t,e){case"RODANDO":S.style.color="var(--accent-color)";break;case"SUCESSO":S.style.color="var(--success-color)";break;case"AGUARDANDO":S.style.color="var(--warning-color)";break;default:S.style.color="var(--text-secondary)"}},mt=async()=>{if(w)return;w=!0,O.disabled=!0;const t=++g;a("Iniciando Planta Técnica Industrial..."),tt.innerText="5.0 m³/h",h=$,V(h),st(t);try{const e=r=>{const n=r!==void 0?r:5e3/o;d&&(d.style.transition=`height ${n}ms linear, y ${n}ms linear`),u&&(u.style.transition=`height ${n}ms linear, y ${n}ms linear`),y&&(y.style.transition=`height ${n}ms linear, y ${n}ms linear`)};if(a("ETAPA 1: Água bruta correndo pela tubulação..."),N?.classList.add("active"),await A(c.PIPE_FLOW,t),a("Dosando Cal Hidratada. Setpoint pH 10.5."),C?.classList.add("active"),U?.classList.add("active"),Q(!0),e(),d&&(d.setAttribute("height","180"),d.setAttribute("y","170")),await Y(7,10.5,c.INTRO,t),C?.classList.remove("active"),U?.classList.remove("active"),N?.classList.remove("active"),T&&(T.style.transition=`height ${c.STAGE_1/o}ms linear, y ${c.STAGE_1/o}ms linear`,T.setAttribute("height","30"),T.setAttribute("y","320")),await X(50,10,c.STAGE_1,t),g!==t)return;Q(!1),a("Precipitação concluída: Lodo sedimentado no fundo."),a("Transferindo e dosando Ácido..."),D?.classList.add("active"),e(),d&&(d.setAttribute("height","0"),d.setAttribute("y","350")),await A(c.PIPE_FLOW,t),F?.classList.add("active"),H?.classList.add("active"),u&&(u.setAttribute("height","180"),u.setAttribute("y","170")),await Y(10.5,5.8,c.TRANS_1_2,t),P.style.borderColor="var(--success-color)",P.querySelector(".stat-value").textContent="SISTEMA SEGURO",F?.classList.remove("active"),H?.classList.remove("active"),D?.classList.remove("active"),a("Monitoramento Etapa 5: Condição ótima (pH 5.8) atingida."),a("ETAPA 2: Adsorção por Alumina Ativada. EBCT: 6 min.");const i=v>=3?4.5:.82;if(v>=3&&a("AVISO: Filtro saturado! Eficiência reduzida."),await X(10,i,c.STAGE_2,t),g!==t)return;if(a("Tratamento concluído. Direcionando para reservatório."),_?.classList.add("active"),e(),u&&(u.setAttribute("height","0"),u.setAttribute("y","350")),await A(c.PIPE_FLOW,t),G?.classList.add("active"),k?.classList.add("active"),y&&(y.setAttribute("height","150"),y.setAttribute("y","200")),await A(c.TRANS_2_3,t),G?.classList.remove("active"),k?.classList.remove("active"),_?.classList.remove("active"),a("Monitoramento Final: Água tratada com sucesso."),L&&(L.style.transition=`fill ${c.TEST/o}ms`,L.style.fill="var(--spadns-pink)"),await A(c.TEST,t),a(`RESULTADO FINAL: ${i} ppm (Remoção Eficiente).`),J(),v++,rt("PRONTO","SUCESSO"),a("RESULTADO: Água Aprovada (Rosa = Limpa)."),et+=20,nt+=.05,J(),v>=3)b.innerText="SATURADO (NECESSITA REGEN.)",b.style.color="var(--danger-color)",W.style.display="block";else{const r=100-v*10;b.innerText=`EFICIENTE (${r}%)`}}catch(e){console.log("Simulação interrompida ou erro:",e)}finally{g===t&&(O.disabled=!1,w=!1)}},X=(t,e,i,r)=>new Promise(n=>{let s=0;const l=50,E=setInterval(()=>{if(g!==r){clearInterval(E);return}s+=l*o;const I=Math.min(1,s/i),R=Math.pow(I,.7),j=t+(e-t)*R;q(j);const ot=$-h;x.push({x:ot,y:j}),ut(),I>=1&&(clearInterval(E),q(e),n(!0))},l)}),Y=(t,e,i,r)=>new Promise(n=>{let s=0;const l=50,E=setInterval(()=>{if(g!==r){clearInterval(E);return}s+=l*o;const I=Math.min(1,s/i),R=t+(e-t)*I;it(R),I>=1&&(clearInterval(E),n(!0))},l)}),ft=()=>{o===1?o=10:o===10?o=100:o===100?o=1e3:o=1,Z.innerText=`ACELERAR (${o}x)`,a(`Velocidade ajustada para ${o}x`),w&&(st(g),(()=>{const e=5e3/o;if(d&&(d.style.transition=`height ${e}ms linear, y ${e}ms linear`),u&&(u.style.transition=`height ${e}ms linear, y ${e}ms linear`),y){const r=5e3*((150-parseFloat(y.getAttribute("height")||"0"))/150)/o;y.style.transition=`height ${r}ms linear, y ${r}ms linear`}})())},gt=()=>{g++,w=!1,O.disabled=!1,x=[],f&&f.clearRect(0,0,m.width,m.height),it(7),q(null),tt.innerText="0.0 m³/h",p&&clearInterval(p),h=$,V(h),rt("AGUARDANDO","AGUARDANDO"),a("Sistema reiniciado e pronto para novo ciclo."),P.style.borderColor="var(--glass-border)",P.querySelector(".stat-value").textContent="SISTEMA SEGURO",[d,u,y,T].forEach(t=>{t&&(t.style.transition="none",t.setAttribute("height","0"),t.setAttribute("y","350"))}),[N,D,_,C,F,G,U,H,k].forEach(t=>t?.classList.remove("active")),L&&(L.style.fill="rgba(48, 54, 61, 0.5)")},pt=()=>{v=0,b.innerText="EFICIENTE (100%)",b.style.color="var(--accent-color)",W.style.display="none",a("Filtro regenerado com NaOH com sucesso!")};O?.addEventListener("click",mt);Z?.addEventListener("click",ft);at?.addEventListener("click",gt);W?.addEventListener("click",pt);m.width=m.offsetWidth;m.height=m.offsetHeight;console.log("Simulation ready.");
