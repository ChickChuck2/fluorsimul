(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const n of i)if(n.type==="childList")for(const g of n.addedNodes)g.tagName==="LINK"&&g.rel==="modulepreload"&&s(g)}).observe(document,{childList:!0,subtree:!0});function o(i){const n={};return i.integrity&&(n.integrity=i.integrity),i.referrerPolicy&&(n.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?n.credentials="include":i.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function s(i){if(i.ep)return;i.ep=!0;const n=o(i);fetch(i.href,n)}})();const E=document.getElementById("start-btn"),D=document.getElementById("speed-btn"),M=document.getElementById("reset-btn"),h=document.getElementById("status-text"),q=document.getElementById("input-ppm"),S=document.getElementById("output-ppm"),N=document.getElementById("log"),a=document.getElementById("liquid-1"),l=document.getElementById("liquid-2"),I=document.getElementById("flow-intro"),b=document.getElementById("flow-stage1-2"),L=document.getElementById("flow-outro"),u=document.getElementById("liquid-3"),G=document.getElementById("timer-text"),v=document.getElementById("result-indicator");let A=!1,r=1,d=null,p=1815,m=0;const f={INTRO:5*1e3,STAGE_1:900*1e3,TRANS_1_2:5*1e3,STAGE_2:720*1e3,TRANS_2_3:5*1e3,TEST:180*1e3},_=Object.values(f).reduce((e,t)=>e+t,0)/1e3,c=e=>{const t=new Date().toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",second:"2-digit"});N.innerHTML=`<div>[${t}] ${e}</div>`+N.innerHTML},O=(e,t)=>{q.innerHTML=`${e.toFixed(1)} <span style="font-size: 0.8rem; font-weight: 400;">ppm</span>`,t!==null?(S.innerHTML=`${t.toFixed(2)} <span style="font-size: 0.8rem; font-weight: 400;">ppm</span>`,S.style.color=t<1.5?"var(--fluoride-low)":"var(--fluoride-high)"):(S.innerHTML='-- <span style="font-size: 0.8rem; font-weight: 400;">ppm</span>',S.style.color="inherit")},R=e=>{const t=Math.floor(e/60),o=Math.floor(e%60);G.innerText=`${t.toString().padStart(2,"0")}:${o.toString().padStart(2,"0")}`},P=e=>{d&&clearInterval(d),d=setInterval(()=>{if(m!==e){d&&clearInterval(d);return}p-=1,p<=0&&(p=0,d&&clearInterval(d)),R(p)},1e3/r)},T=(e,t)=>new Promise((o,s)=>{let i=0;const n=50,y=setInterval(()=>{if(m!==t){clearInterval(y),s("Simulação cancelada");return}i+=n*r,i>=e&&(clearInterval(y),o(!0))},n)}),w=(e,t)=>{switch(h.innerText=e,t){case"RODANDO":h.style.color="var(--accent-color)";break;case"SUCESSO":h.style.color="var(--success-color)";break;case"AGUARDANDO":h.style.color="var(--warning-color)";break;default:h.style.color="var(--text-secondary)"}},H=async()=>{if(A)return;A=!0,E.disabled=!0;const e=++m;w("FILTRANDO...","RODANDO"),p=_,R(p),P(e);try{const t=o=>{const s=o!==void 0?o:5e3/r;a&&(a.style.transition=`height ${s}ms linear, y ${s}ms linear`),l&&(l.style.transition=`height ${s}ms linear, y ${s}ms linear`),u&&(u.style.transition=`height ${s}ms linear, y ${s}ms linear`)};if(c("Passo 1: Cal adicionada. Tempo real: 15 min."),I?.classList.add("active"),t(),a&&(a.setAttribute("height","180"),a.setAttribute("y","170")),await T(f.INTRO,e),I?.classList.remove("active"),await B(50,10,f.STAGE_1,e),m!==e||(c("Flúor caiu: 50 -> 10 ppm."),c("Transferindo água para Alumina..."),b?.classList.add("active"),t(),a&&(a.setAttribute("height","0"),a.setAttribute("y","350")),l&&(l.setAttribute("height","180"),l.setAttribute("y","170")),await T(f.TRANS_1_2,e),b?.classList.remove("active"),c("Passo 2: Polimento com Alumina. Tempo real: 12 min."),await B(10,.82,f.STAGE_2,e),m!==e))return;c("Água polida! Nível final: 0.82 ppm."),c("Enchendo reservatório de saída..."),L?.classList.add("active"),t(),l&&(l.setAttribute("height","0"),l.setAttribute("y","350")),u&&(u.setAttribute("height","150"),u.setAttribute("y","200")),await T(f.TRANS_2_3,e),L?.classList.remove("active"),c("Teste de Qualidade: O Rosa indica que está pura."),v&&(v.style.transition=`fill ${f.TEST/r}ms`,v.style.fill="var(--spadns-pink)"),await T(f.TEST,e),w("PRONTO","SUCESSO"),c("RESULTADO: Água Aprovada (Rosa = Limpa).")}catch(t){console.log("Simulação interrompida ou erro:",t)}finally{m===e&&(E.disabled=!1,A=!1)}},B=(e,t,o,s)=>new Promise(i=>{let n=0;const g=50,y=setInterval(()=>{if(m!==s){clearInterval(y);return}n+=g*r;const $=Math.min(1,n/o),x=e+(t-e)*$;O(50,x),$>=1&&(clearInterval(y),O(50,t),i(!0))},g)}),U=()=>{r===1?r=10:r===10?r=100:r===100?r=1e3:r=1,D.innerText=`ACELERAR (${r}x)`,c(`Velocidade ajustada para ${r}x`),A&&(P(m),(()=>{const t=5e3/r;if(a&&(a.style.transition=`height ${t}ms linear, y ${t}ms linear`),l&&(l.style.transition=`height ${t}ms linear, y ${t}ms linear`),u){const s=5e3*((150-parseFloat(u.getAttribute("height")||"0"))/150)/r;u.style.transition=`height ${s}ms linear, y ${s}ms linear`}})())},F=()=>{m++,A=!1,E.disabled=!1,d&&clearInterval(d),p=_,R(p),w("AGUARDANDO","AGUARDANDO"),O(50,null),c("Sistema reiniciado e pronto para novo ciclo."),[a,l,u].forEach(e=>{e&&(e.style.transition="none",e.setAttribute("height","0"),e.setAttribute("y","350"))}),[I,b,L].forEach(e=>e?.classList.remove("active")),v&&(v.style.fill="rgba(48, 54, 61, 0.5)")};E?.addEventListener("click",H);D?.addEventListener("click",U);M?.addEventListener("click",F);console.log("Simulation ready.");
